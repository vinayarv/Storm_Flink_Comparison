CREATE TABLE T_FLINK_PCT AS Select COUNT REC_EMIT, COUNT(1) REC_PRCSD, (COUNT(1) /COUNT)*100 PCT_PRCSD, WIND_TS    from (
Select count(1)  count, wind_ts from (
SELECT 
   READ_KAFKA_TS, WRSQL_TS, wind_ts
FROM
    (SELECT 
        a.*, wind_ts
    FROM
         ( SELECT 
        *
    FROM
        (SELECT 
        READ_TS + INTERVAL Seq_no SECOND wind_ts
    FROM
        (SELECT 
        MIN(READ_KAFKA_TS ) read_ts
    FROM
        T_FLINK_EXTR_COL) a, (SELECT 
        @rownum:=@rownum + 1 AS Seq_no
    FROM
        (SELECT @rownum:=0) b, (SELECT 
        1
        FROM
        T_FLINK_EXTR_COL) c) b) e  LIMIT 150) g LEFT JOIN T_FLINK_EXTR_COL a   
    ON (
        READ_KAFKA_TS  >= (wind_ts - INTERVAL 1 SECOND)
            AND READ_KAFKA_TS  <= wind_ts)) f) h
GROUP BY wind_ts) i LEFT JOIN T_FLINK_EXTR_COL j
ON ( j.WRSQL_TS >= (i.wind_ts - INTERVAL 1 SECOND) and j.WRSQL_TS <= i.wind_ts AND j. READ_KAFKA_TS  >=  (i.wind_ts - INTERVAL 1 SECOND)  AND j. READ_KAFKA_TS <= i.WIND_TS) 
GROUP BY WIND_TS;
